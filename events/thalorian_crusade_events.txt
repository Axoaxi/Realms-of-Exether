namespace = thalorian_crusade

# Victory
 thalorian_crusade.1 = {
	type = country_event
	placement = root
	title =  thalorian_crusade.1.t
	desc =  thalorian_crusade.1.d
	flavor =  thalorian_crusade.1.f

	duration = 3

	event_image = {
		video = "unspecific_military_parade"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	immediate = {
		ruler = {
			save_scope_as = ruler_scope
		}
	}		

	option = {
		name =  thalorian_crusade.1.a
		default_option = yes
		if = {
			limit = {
				root = c:RAV
			}
			show_as_tooltip = {
				c:TLE = {
					ruler = {
						kill_character = yes
					}

					#Create Dunavara
					every_scope_state = {
						limit = {
							state_region = s:STATE_STORMHOLM
							state_region = s:STATE_WINDSONG
							state_region = s:STATE_MISTVALE
							state_region = s:STATE_MOONSHADE
							state_region = s:STATE_IRONWOOD
							state_region = s:STATE_TIMMERHAVEN
						}
					set_variable = state_to_cede_to_dnv
					}
					create_country = {
						tag = DNV
						origin = c:TLE
						cede_state_trigger = {
							has_variable = state_to_cede_to_dnv
						}
					}

					#Create Thalrea
					every_scope_state = {
						limit = {
							state_region = s:STATE_STORMWATCH
							state_region = s:STATE_HIGHMOOR
							state_region = s:STATE_FARREACH
							state_region = s:STATE_EVERLUND
							state_region = s:STATE_HAVENSHIRE
							state_region = s:STATE_MOONSHADE
						}
					set_variable = state_to_cede_to_tha
					}
					create_country = {
						tag = THA
						origin = c:TLE
						cede_state_trigger = {
							has_variable = state_to_cede_to_tha
						}
					}

					#Create Oltora
					every_scope_state = {
						limit = {
							state_region = s:STATE_SILVERCREST
							state_region = s:STATE_THORNFIELD
						}
					set_variable = state_to_cede_to_olt
					}
					create_country = {
						tag = OLT
						origin = c:TLE
						cede_state_trigger = {
							has_variable = state_to_cede_to_olt
						}
					}

					#Create Vranceana
					every_scope_state = {
						limit = {
							state_region = s:STATE_BRIGHTWATER
							state_region = s:STATE_SUNDALE
							state_region = s:STATE_WHITESTONE
						}
					set_variable = state_to_cede_to_vrc
					}
					create_country = {
						tag = VRC
						origin = c:TLE
						cede_state_trigger = {
							has_variable = state_to_cede_to_vrc
						}
					}

					change_tag = THY
	
				}
			}
		}

	}
}

# White Peace/Invalid
 thalorian_crusade.2 = {
	type = country_event
	placement = root
	title =  thalorian_crusade.2.t
	desc =  thalorian_crusade.2.d
	flavor =  thalorian_crusade.2.f

	duration = 3

	event_image = {
		video = "europenorthamerica_london_center"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	trigger = {
		# triggered by je_abolish_monarchy
	}

	option = {
		name =  thalorian_crusade.2.a
		default_option = yes
		ig:ig_landowners = {
			remove_ideology = ideology_paternalistic
			remove_ideology = ideology_scholar_paternalistic
			remove_ideology = ideology_junker_paternalistic
			remove_ideology = ideology_papal_paternalistic
			add_ideology = ideology_republican_paternalistic
		}
		custom_tooltip = {
			text = no_more_royalists
			set_variable = monarchy_stamped_out_var
		}
		every_interest_group = {
			limit = {
				leader = {
					has_monarchist_ideology = yes
				}
			}
			leader = {
				set_ideology = ideology:ideology_moderate
			}
		}
	}
	option = {
		name =  thalorian_crusade.2.b
		# don't do that, just make landowners lose power
		ig:ig_landowners = {
			add_modifier = {
				name = monarchist_nostalgia
				months = normal_modifier_time
			}
		}
	}
}

# Defeat
 thalorian_crusade.3 = {
	type = country_event
	placement = root
	title =  thalorian_crusade.3.t
	desc =  thalorian_crusade.3.d
	flavor =  thalorian_crusade.3.f

	duration = 3

	event_image = {
		video = "europenorthamerica_political_extremism"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	trigger = {
		OR = {
			is_enacting_law = law_type:law_census_voting
			is_enacting_law = law_type:law_universal_suffrage
		}
		OR = {
			has_law = law_type:law_autocracy
			has_law = law_type:law_oligarchy
			has_law = law_type:law_landed_voting
			has_law = law_type:law_wealth_voting
		}
		any_interest_group = {
			is_in_government = yes
			leader = {
				has_ideology = ideology:ideology_radical
			}
		}
		NOT = {
			has_modifier = no_new_constitution
		}
	}

	immediate = {
		currently_enacting_law = {
			save_scope_as = current_law_scope
		}
		random_interest_group = {
			limit = {
				is_in_government = yes
				leader = {
					has_ideology = ideology:ideology_radical
				}
			}
			leader = {
				save_scope_as = radical_leader_scope
			}
		}
		if = {
			limit = {
				has_law = law_type:law_autocracy
			}
			law_type:law_autocracy = {
				save_scope_as = current_voting_law_scope
			}
		}
		if = {
			limit = {
				has_law = law_type:law_oligarchy
			}
			law_type:law_oligarchy = {
				save_scope_as = current_voting_law_scope
			}
		}
		if = {
			limit = {
				has_law = law_type:law_landed_voting
			}
			law_type:law_landed_voting = {
				save_scope_as = current_voting_law_scope
			}
		}
		if = {
			limit = {
				has_law = law_type:law_wealth_voting
			}
			law_type:law_wealth_voting = {
				save_scope_as = current_voting_law_scope
			}
		}
	}

	option = {
		name =  thalorian_crusade.3.a
		if = {
			limit = {
				is_enacting_law = law_type:law_census_voting
			}
			activate_law = law_type:law_census_voting
		}
		if = {
			limit = {
				is_enacting_law = law_type:law_universal_suffrage
			}
			activate_law = law_type:law_universal_suffrage
		}
		# reactionaries get VERY angry
		every_interest_group = {
			limit = {
				is_marginal = no
				law_stance = {
					law = scope:current_voting_law_scope
					value > neutral
				}
			}
			add_modifier = {
				name = radical_constitution
				months = short_modifier_time
			}
		}
		ai_chance = {
			base = 25
			modifier = {
				trigger = {
					NOT = {
						any_interest_group = {
							law_stance = {
								law = scope:current_voting_law_scope
								value > neutral
							}
							is_powerful = yes
						}
					}
				}
				add = -15
			}
		}
	}
	option = {
		name =  thalorian_crusade.3.b
		default_option = yes
		# gain success chance, lose enactment time
		add_enactment_modifier = {
			name = no_new_constitution
		}
		ai_chance = {
			base = 75
		}
	}
}
